# Solvate a protein from PDB

This assumes that you have a PDB file of your complete PROTONATED protein chain (and ligand if applicable). If you have multiple chains, select one now. If you are missing residues or protons go back and follow the instructions in `AddMissingResidues.md` and `AddHydrogensPDB.md`, respectively. 

### What is the charge of the system ?
The charge of the protein is computed by adding the charge of all residues. Only HIS, ARG, LYS, GLU and ASP are charged so the problem is equivalent to counting how many of these residues you have in your protein. 

There is a very simple tool to help you do that, which you can download with the [Packmol software](http://m3g.iqm.unicamp.br/packmol/download.shtml). Once you have downloaded the binaries, look for the executable `solvate.tcl`

Then navigate to the directory where you have your protein chain PDB and execute the script:

```sh
cd $PATH_to_directory
~/Downloads/packmol/solvate.tcl Name_of_file.pdb

```
Note that it may be a good idea to move the binaries from the `Downloads` folder. Don't forget to update the path to `solvate.tcl` if that is the case. 

This should return the total structure charge, for example:

```sh
  HIS = 6 (associated charge = 0) 
  ARG = 26 (associated charge = +26) 
  LYS = 36 (associated charge = +36) 
  GLU = 36 (associated charge = -36) 
  ASP = 34 (associated charge = -34) 
 -------------------------------------------------------
  Total structure charge = -8
```

Note that you obtain additional information from the routine that you may find useful, such as

```sh
  Number of water molecules to be put:   26231 
  Total volume: 881702.27 A^3
  Volume occupied by water: 784326.28 A^3 
  Number of Sodium ions to be put: 76
  Number of Chloride ions to be put: 68
  Wrote packmol input. 
 -------------------------------------------------------
  Use these lengths for periodic boundary conditions: 
  x: 88.17699999999999
  y: 118.41000000000001
  z: 87.142
```

### Solvate the protein on Cascades
There are a number of routines available to solvate a protein. However, in the Welborn Group, we use Gromacs `solvate` routine as it allows water to be within as well as outside the protein. Gromacs is already installed on Cascades so we continue there. 

Copy the file over and log onto Cascades:

```sh
scp Name_of_file.pdb username@cascades1.arc.vt.edu:/path_to_working_directory/
ssh username@cascades1.arc.vt.edu
cd path_to_working_directory

```
Write the script `solvate.sh` that contains:

```sh
#!/bin/bash -l
#SBATCH -p dev_q
#SBATCH -J Solvate
#SBATCH -N 1
#SBATCH --ntasks-per-node 32
#SBATCH -t 00:01:00 
#SBATCH -A welbornlab
 
module load gcc/5.2.0  mvapich2/2.2
module load gcc/5.2.0  openmpi/3.0.0
module load gcc/5.2.0  openmpi/3.1.2
module load gcc/6.1.0  openmpi/3.0.0
module load gcc/6.1.0  openmpi/3.1.2
module load intel/15.3  mvapich2/2.2
module load intel/15.3  openmpi/3.0.0
module load intel/15.3  openmpi/3.1.2
module load intel/18.2  openmpi/3.0.0
module load fftw/3.3.8
module load gromacs/5.1.2 
​
#center the protein in a box. Change the name of the input file (protein_input.pdb and the size of the box. The units are in nm here!
gmx editconf -f protein_input.pdb -o Box.pdb -box 8.000 8.000 8.000 -c 
​
#Fill the box with water. You can change the name of the output file (Box_Water.pdb)
gmx solvate -cp Box.pdb -o Box_Water.pdb
​
#Insert ions, making sure the system is overall neutral (Chloride here but could be sodium if positive charges are needed or both if we want 0.1M ions for example). You need to change how many ions you want (19 here) and the name of the output file. Chloride.pdb is an input.
gmx insert-molecules -f Box_Water.pdb -nmol 19 -ci Chloride.pdb -o Box_Water_Cl.pdb
```

For which you need the additional input `Chloride.pdb`

```sh
COMPND    UNNAMED
AUTHOR    GENERATED BY OPEN BABEL 2.3.90
HETATM    1 CL    CL     1      -1.694  -0.065   0.000  1.00  0.00          Cl  
MASTER        0    0    0    0    0    0    0    0    1    0    1    0
END
```

or `Sodium.pdb`

```sh
COMPND    UNNAMED
AUTHOR    GENERATED BY OPEN BABEL 2.3.90
HETATM    1 NA    NA     1      -1.694  -0.065   0.000  1.00  0.00          Na  
MASTER        0    0    0    0    0    0    0    0    1    0    1    0
END
```

Note that since the solvation process is very short, you have two options to execute the script.

Option 1 (preferred): run it interactively by typing `./solvate.sh`.

Option 2: use the `dev_q` to submit the job on the queue by typing `sbatch solvate.sh`


